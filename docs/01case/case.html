<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="paragraph"><p><a href="../index.html">Outline</a></p></div>
<div class="sect1">
<h2 id="_case_studies_introduction">Case Studies - Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>It&#8217;s an excisting time to be making projects that use embedded processors.
Make:'s <a href="https://makezine.com/comparison/boards/">Makers' Guide to Boards</a> shows
many of the options that are available and groups them into different types.
<em>Single board computers</em> (SBCs) generally run Linux on some sort of <a href="https://www.arm.com/">ARM</a>
processor.  Examples are the BeagleBoard and the Raspberry Pi.  Another type
is the <em>microcontroller</em>, of which the <a href="https://www.arduino.cc/">Arduion</a> is
popular.</p></div>
<div class="paragraph"><p>The SBCs are used because they have an operating system to manage files, I/O, and schedule when things are run all while talking to the Internet.
Microcontrollers shine when things
being interfaced require careful timing and can&#8217;t afford to have an OS preempt an
operation.</p></div>
<div class="paragraph"><p>But what if you have a projcet that needs the flexibility of an OS and the timing
of a microcontroller?  This is where the BeagleBoard shines since it has both
an ARM procssor running Linux and two <strong>P</strong>rogrammable <strong>R</strong>eal-Time <strong>U</strong>nits (PRUs).</p></div>
<div class="paragraph"><p>The PRUs have 32-bit cores which run
independently of the ARM processor, therefore they can
be programmed to respond quickly to inputs and produce very precisely timed
outputs.</p></div>
<div class="paragraph"><p>There are many projects that use the PRU (<a href="http://processors.wiki.ti.com/index.php/PRU_Projects">http://processors.wiki.ti.com/index.php/PRU_Projects</a>) to do things that can&#8217;t be
done with just a SBC or just a microcontroller. Here we present some case studies that give a high-level view of using the PRUs.  In later
chapters you will see the details of how they work.</p></div>
<div class="paragraph"><p>Here we present</p></div>
<div class="ulist"><ul>
<li>
<p>
Robotics Control Library <a href="http://strawsondesign.com/docs/roboticscape/">http://strawsondesign.com/docs/roboticscape/</a>
</p>
</li>
<li>
<p>
BeagleLogic <a href="https://github.com/abhishek-kakkar/BeagleLogic/wiki">https://github.com/abhishek-kakkar/BeagleLogic/wiki</a>
</p>
</li>
<li>
<p>
LEDscape <a href="https://github.com/Yona-Appletree/LEDscape">https://github.com/Yona-Appletree/LEDscape</a>
</p>
</li>
<li>
<p>
MachineKit <a href="http://www.machinekit.io/">http://www.machinekit.io/</a>
</p>
</li>
<li>
<p>
ArduPilot <a href="http://ardupilot.org/">http://ardupilot.org/</a>, <a href="http://ardupilot.org/dev/docs/beaglepilot.html">http://ardupilot.org/dev/docs/beaglepilot.html</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>The following are resources used in this chapter.</p></div>
<div class="ulist"><div class="title">Resources</div><ul>
<li>
<p>
<a href="https://github.com/beagleboard/pocketbeagle/wiki/System-Reference-Manual#673_PRUICSS_Pin_Access">Pocket Beagle System Reference Manual</a>
</p>
</li>
<li>
<p>
<a href="https://github.com/derekmolloy/exploringBB/blob/master/chp06/docs/BeagleboneBlackP8HeaderTable.pdf">P8 Header Table</a>
</p>
</li>
<li>
<p>
<a href="https://github.com/derekmolloy/exploringBB/blob/master/chp06/docs/BeagleboneBlackP9HeaderTable.pdf">P9 Header Table</a>
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_robotics_control_library">Robotics Control Library</h3>
<div class="paragraph"><p>The <a href="http://strawsondesign.com/docs/roboticscape/">Robotics Control Library</a> is a package, that is already installed,
that contains a C library and example/testing programs for the BeagleBone Blue
and the BeagleBone Black with Robotics Cape. It uses the PRU to extend the real-time hardware of the Bone.</p></div>
<div class="sect3">
<h4 id="_configuring_pins">Configuring Pins</h4>
<div class="sect4">
<h5 id="_problem">Problem</h5>
<div class="paragraph"><p>You want to configure the pins so the PRU input and outputs are accessable.</p></div>
</div>
<div class="sect4">
<h5 id="_solution">Solution</h5>
<div class="paragraph"><p>It depends on which Beagle you are running on.  If you are on the Blue, everything is already configured for you.
If you are on the Black or Pocket you&#8217;ll need to run the following script.</p></div>
<div class="listingblock">
<div class="title">servos_setup.sh</div>
<div class="content">
<pre><code>#!/bin/bash
# Configure the PRU pins based on which Beagle is running
machine=$(awk '{print $NF}' /proc/device-tree/model)
echo -n $machine
if [ $machine = "Black" ]; then
    echo " Found"
    pins="P8_27 P8_28 P8_29 P8_30 P8_39 P8_40 P8_41 P8_42"
elif [ $machine = "Blue" ]; then
    echo " Found"
    pins=""
elif [ $machine = "PocketBeagle" ]; then
    echo " Found"
    pins="P2_35 P1_35 P1_02 P1_04"
else
    echo " Not Found"
    pins=""
fi

for pin in $pins
do
    echo $pin
    config-pin $pin pruout
    config-pin -q $pin
done</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_discussion">Discussion</h5>
<div class="paragraph"><p>The first part of the code looks in <code>/proc/device-tree/model</code> to see which Beagle is running. Based on that it
assigns <code>pins</code> a list of pins to configure.  Then the last part of the script loops through each of the pins and configures it.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_controlling_eight_servos">Controlling Eight Servos</h4>
<div class="sect4">
<h5 id="_problem_2">Problem</h5>
<div class="paragraph"><p>You need to control eight servos, but the Bone doesn&#8217;t have enough PWMs.</p></div>
</div>
<div class="sect4">
<h5 id="_solution_2">Solution</h5>
<div class="paragraph"><p>The Robotics Control Library provides eight additional PWM channels via the PRU that can be used out of the box.  Just run:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>bone$ *sudo rc_test_servos -f 10 -p 1.5*</code></pre>
</div></div>
<div class="paragraph"><p>The <code>-f 10</code> says to use a frequency of 10 Hz and the <code>-p 1.5</code> says to set the position to <code>1.5</code>.  The range of positions is
<code>-1.5</code> to <code>1.5</code>.   Run <code>rc_test_servos -h</code> to see all the options.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>bone$ *rc_test_servos -h*

 Options
 -c {channel}   Specify one channel from 1-8.
                Otherwise all channels will be driven equally
 -f {hz}        Specify pulse frequency, otherwise 50hz is used
 -p {position}  Drive servo to a position between -1.5 &amp; 1.5
 -w {width_us}  Send pulse width in microseconds (us)
 -s {limit}     Sweep servo back/forth between +- limit
                Limit can be between 0 &amp; 1.5
 -r {ch}        Use DSM radio channel {ch} to control servo
 -h             Print this help messege

sample use to center servo channel 1:
   rc_test_servo -c 1 -p 0.0</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_discussion_2">Discussion</h5>
<div class="paragraph"><p>The BeagleBone Blue sends these eight outputs to it&#8217;s servo channels.  The Black and the Pocket use the pins shown in the
<a href="#_register_to_pin_table">Register to pin table</a>.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 1. PRU register to pin table</caption>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">PRU pin</p></td>
<td align="left" valign="top"><p class="table">Blue pin</p></td>
<td align="left" valign="top"><p class="table">Black pin</p></td>
<td align="left" valign="top"><p class="table">Pocket pin</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">pru1_r30_8</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
<td align="left" valign="top"><p class="table">P8_27</p></td>
<td align="left" valign="top"><p class="table">P2.35</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">pru1_r30_10</p></td>
<td align="left" valign="top"><p class="table">2</p></td>
<td align="left" valign="top"><p class="table">P8_28</p></td>
<td align="left" valign="top"><p class="table">P1.35</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">pru1_r30_9</p></td>
<td align="left" valign="top"><p class="table">3</p></td>
<td align="left" valign="top"><p class="table">P8_29</p></td>
<td align="left" valign="top"><p class="table">P1.02</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">pru1_r30_11</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
<td align="left" valign="top"><p class="table">P8_30</p></td>
<td align="left" valign="top"><p class="table">P1.04</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">pru1_r30_6</p></td>
<td align="left" valign="top"><p class="table">5</p></td>
<td align="left" valign="top"><p class="table">P8_39</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">pru1_r30_7</p></td>
<td align="left" valign="top"><p class="table">6</p></td>
<td align="left" valign="top"><p class="table">P8_40</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">pru1_r30_4</p></td>
<td align="left" valign="top"><p class="table">7</p></td>
<td align="left" valign="top"><p class="table">P8_41</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">pru1_r30_5</p></td>
<td align="left" valign="top"><p class="table">8</p></td>
<td align="left" valign="top"><p class="table">P8_42</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>You can find these details in the
<a href="https://github.com/derekmolloy/exploringBB/blob/master/chp06/docs/BeagleboneBlackP8HeaderTable.pdf">P8 Header Table</a>,
<a href="https://github.com/derekmolloy/exploringBB/blob/master/chp06/docs/BeagleboneBlackP9HeaderTable.pdf">P9 Header Table</a> and then <a href="https://github.com/beagleboard/pocketbeagle/wiki/System-Reference-Manual#673_PRUICSS_Pin_Access">Pocket Beagle System Reference Manual</a>.</p></div>
<div class="paragraph"><p>Be default the PRUs are already loaded with the code needed to run the
servos.  All you have to do is run the command.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_controlling_individual_servos">Controlling Individual Servos</h4>
<div class="sect4">
<h5 id="_problem_3">Problem</h5>
<div class="paragraph"><p><code>rc_test_servos</code> is nice, but I need to control the servos individually.</p></div>
</div>
<div class="sect4">
<h5 id="_solution_3">Solution</h5>
<div class="paragraph"><p>You can modify <code>rc_test_servos.c</code>.  You&#8217;ll find it on the bone at
<code>/opt/source/Robotics_Cape_Installer/examples/src/rc_test_servos.c</code>, or online at
<a href="https://github.com/StrawsonDesign/Robotics_Cape_Installer/blob/master/examples/src/rc_test_servos.c">https://github.com/StrawsonDesign/Robotics_Cape_Installer/blob/master/examples/src/rc_test_servos.c</a>.</p></div>
<div class="paragraph"><p>Just past line 250 you&#8217;ll find a <code>while</code> loop that has calls to <code>rc_servo_send_pulse_normalized(ch,servo_pos)</code> and
<code>rc_servo_send_pulse_us(ch, width_us)</code>.  The first call sets the pulse width relative to the pulse period; the other
sets the width to an absolute time.  Use whichever works for you.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_controlling_more_than_eight_channels">Controlling More Than Eight Channels</h4>
<div class="sect4">
<h5 id="_problem_4">Problem</h5>
<div class="paragraph"><p>I need more than eight PWM channels, or I need less jitter on the off time.</p></div>
</div>
<div class="sect4">
<h5 id="_solution_4">Solution</h5>
<div class="paragraph"><p>This is a more advanced problem and required reprograming the PRUs.  See
&lt;&lt;../05blocks/blocks.html#, Building Blocks - Applications&gt;&gt; for an example.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_reading_hardware_encoders">Reading Hardware Encoders</h4>
<div class="sect4">
<h5 id="_problem_5">Problem</h5>
<div class="paragraph"><p>I want to use four encoders to measure four motors, but I only see hardware for three.</p></div>
</div>
<div class="sect4">
<h5 id="_solution_5">Solution</h5>
<div class="paragraph"><p>The forth encoder can be implemented on the PRU. If you run <code>rc_test_encoders_eqep</code> on the Blue, you will see the output of
encoders E1-E3 which are connected to the eEQP hardware.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>bone$ *rc_test_encoders_eqep*

Raw encoder positions
      E1   |      E2   |      E3   |
         0 |         0 |         0 |^C</code></pre>
</div></div>
<div class="paragraph"><p>You can also access these hardware encoders on the Black and Pocket using the pins shown below.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 2. eQEP to pin mapping</caption>
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">eQEP</p></td>
<td align="left" valign="top"><p class="table">Blue pin</p></td>
<td align="left" valign="top"><p class="table">Black pin A</p></td>
<td align="left" valign="top"><p class="table">Black pin B</p></td>
<td align="left" valign="top"><p class="table">Pocket pin A</p></td>
<td align="left" valign="top"><p class="table">Pocket pin B</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">E1</p></td>
<td align="left" valign="top"><p class="table">P9_42B</p></td>
<td align="left" valign="top"><p class="table">P9_27</p></td>
<td align="left" valign="top"><p class="table">P1.31</p></td>
<td align="left" valign="top"><p class="table">P2.24</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">1</p></td>
<td align="left" valign="top"><p class="table">E2</p></td>
<td align="left" valign="top"><p class="table">P8_35</p></td>
<td align="left" valign="top"><p class="table">P8_33</p></td>
<td align="left" valign="top"><p class="table">P2.10</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">2</p></td>
<td align="left" valign="top"><p class="table">E3</p></td>
<td align="left" valign="top"><p class="table">P8_12</p></td>
<td align="left" valign="top"><p class="table">P8_11</p></td>
<td align="left" valign="top"><p class="table">P2.24</p></td>
<td align="left" valign="top"><p class="table">P2.33</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">2</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">P8_41</p></td>
<td align="left" valign="top"><p class="table">P8_42</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">E4</p></td>
<td align="left" valign="top"><p class="table">P8_16</p></td>
<td align="left" valign="top"><p class="table">P8_15</p></td>
<td align="left" valign="top"><p class="table">P2.09</p></td>
<td align="left" valign="top"><p class="table">P2.18</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>You will need to first configure the pins using <code>encoder.sh</code>.</p></div>
<div class="listingblock">
<div class="title">encoder.sh</div>
<div class="content">
<pre><code>#!/bin/bash
# Configure the pins based on which Beagle is running
machine=$(awk '{print $NF}' /proc/device-tree/model)
echo -n $machine

# Configure eQEP pins
if [ $machine = "Black" ]; then
    echo " Found"
    pins="P9_92 P9_27 P8_35 P8_33 P8_12 P8_11 P8_41 P8_42"
elif [ $machine = "Blue" ]; then
    echo " Found"
    pins=""
elif [ $machine = "PocketBeagle" ]; then
    echo " Found"
    pins="P1_31 P2_34 P2_10 P2_24 P2_33"
else
    echo " Not Found"
    pins=""
fi

for pin in $pins
do
    echo $pin
    config-pin $pin qep
    config-pin -q $pin
done

##########################################
# Configure PRU pins
if [ $machine = "Black" ]; then
    echo " Found"
    pins="P8_16 P8_15"
elif [ $machine = "Blue" ]; then
    echo " Found"
    pins=""
elif [ $machine = "PocketBeagle" ]; then
    echo " Found"
    pins="P2_09 P2_18"
else
    echo " Not Found"
    pins=""
fi

for pin in $pins
do
    echo $pin
    config-pin $pin pruin
    config-pin -q $pin
done</code></pre>
</div></div>
<div class="paragraph"><p>The eQEP pins are configured with the top half of the code.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_reading_pru_encoder">Reading PRU Encoder</h4>
<div class="sect4">
<h5 id="_problem_6">Problem</h5>
<div class="paragraph"><p>I want to access the PRU encoder.</p></div>
</div>
<div class="sect4">
<h5 id="_solution_6">Solution</h5>
<div class="paragraph"><p>The forth encoder is implemented on the PRU and accessed with <code>sudo rc_test_encoders_pru</code></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>This command
needs root permission, so the <code>sudo</code> is needed.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Here&#8217;s what you will see</p></div>
<div class="listingblock">
<div class="content">
<pre><code>bone$ *sudo rc_test_encoders_pru*
[sudo] password for debian:

Raw encoder position
      E4   |
         0 |^C</code></pre>
</div></div>
<div class="paragraph"><p>If you aren&#8217;t running the Blue you will have to configure the pins as shown above.  The bottom half of the code
does the PRU configuring.</p></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_beaglelogic_a_14_channel_logic_analyzer">BeagleLogic - a 14-channel Logic Analyzer</h3>
<div class="sect3">
<h4 id="_problem_7">Problem</h4>
<div class="paragraph"><p>I need a 100Msps, 14-channel logic analyzer</p></div>
</div>
<div class="sect3">
<h4 id="_solution_7">Solution</h4>
<div class="paragraph"><p><a href="https://github.com/abhishek-kakkar/BeagleLogic/wiki">BeagleLogic</a> is a 100Msps, 14-channel logic analyzer that runs on the
Beagle. The quickest solution is to get the <a href="https://github.com/abhishek-kakkar/BeagleLogic/wiki/BeagleLogic-%22no-setup-required%22-setup:-Introducing-System-Image!">no-setup-required image</a>.  It runs on an older image (15-Apr-2016) but should still work.</p></div>
<div class="paragraph"><p>If you want to be running a newer image, there are instructions on the site for <a href="https://github.com/abhishek-kakkar/BeagleLogic/wiki/Build-BeagleLogic">building BeagleLogic from scratch</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_3">Discussion</h4>
<div class="paragraph"><p>BeagleLogic uses the two PRUs to sample at 100Msps.  Getting a PRU running at 200Hz to sample at 100Msps is a slick trick.
<a href="http://theembeddedkitchen.net/beaglelogic-building-a-logic-analyzer-with-the-prus-part-1/449">The Embedded Kitchen</a> has a nice article
explaining how the PRUs get this type of performance.   In section
&lt;&lt;../05blocks/blocks.html#, Building Blocks&gt;&gt; we&#8217;ll give an overview of the technique.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_ledscape">LEDScape</h3>
<div class="sect3">
<h4 id="_problem_8">Problem</h4>
<div class="paragraph"><p>You have an <a href="http://www.adafruit.com/products/1138">Adafruit NeoPixel LED string</a>
or <a href="http://www.adafruit.com/products/1487">Adafruit NeoPixel LED matrix</a>
and want to light it up.</p></div>
</div>
<div class="sect3">
<h4 id="_solution_8">Solution</h4>
<div class="paragraph"><p>You can either write your own code (See the Building Blocks chapter for an
example.) Or use a library.</p></div>
<div class="paragraph"><p><a href="https://github.com/Yona-Appletree/LEDscape">LEDScape</a> is a library for
controlling NeoPixels.</p></div>
<div class="verseblock">
<pre class="content">LEDscape is a library and service for controlling individually addressable LEDs from a Beagle Bone Black or Beagle Bone Green using the onboard PRUs. It currently supports WS281x (WS2811, WS2812, WS2812b), WS2801 and initial support for DMX.

It can support up to 48 connected strings and can drive them with very little load on the main processor.

Background
LEDscape was originally written by Trammell Hudson (<a href="http://trmm.net/Category:LEDscape">http://trmm.net/Category:LEDscape</a>) for controlling WS2811-based LEDs. Since his original work, his version (<a href="https://github.com/osresearch/LEDscape">https://github.com/osresearch/LEDscape</a>) has been repurposed to drive a different type of LED panel (e.g. <a href="http://www.adafruit.com/products/420">http://www.adafruit.com/products/420</a>).

This version of the library was forked from his original WS2811 work. Various improvements have been made in the attempt to make an accessible and powerful LED driver based on the BBB. Many thanks to Trammell for his excellent work in scaffolding the BBB and PRUs for driving LEDs.</pre>
<div class="attribution">
&#8212; https://github.com/Yona-Appletree/LEDscape
</div></div>
<div class="paragraph"><p>LEDScape can drive 48 strings of LEDs are arbitary length with no addional
hardware!</p></div>
</div>
<div class="sect3">
<h4 id="_discussion_4">Discussion</h4>
<div class="paragraph"><p>LEDScape was written for an earlier version of the Linux kernel, so you will
have to follow the instructions for installing it.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_machinekit">MachineKit</h3>
<div class="paragraph"><p>MachineKit is a platform for machine control applications.  It can control
machine tools, robots, or other automated devices. It can control servo
motors, stepper motors, relays, and other devices related to machine tools.</p></div>
</div>
<div class="sect2">
<h3 id="_ardupilot">ArduPilot</h3>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2018-07-23 08:45:19 EDT
</div>
</div>
</body>
</html>
